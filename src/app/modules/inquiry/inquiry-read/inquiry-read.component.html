<div *ngIf="$inquiry | async as inquiry">
  <ng-template #parentTemplate>
    <app-adult-card title="Законный представитель" [entity]="inquiry.parent" [edit]="edit.person">
    </app-adult-card>
  </ng-template>
  <div class="row">
    <div class="{{inquiry.applicant || inquiry.applicantType == applicantTypes.Child ? 'col-md-12' : 'col-md-6'}}">
      <app-inquiry-info-edit title="Заявление {{inquiry.number}}">
        <div class="row">
          <div class="col-md-6">
            <h4>Заявление в {{inquiry.typeFriendlyName}}</h4>
            <app-inquiry-common-info [inquiry]="inquiry">
              <dt>Заявление на перевод</dt>
              <dd>Нет</dd>
              <div *ngIf="inquiry && inquiry.privilege && inquiry.privilege.privilegeOrder">
                <dt>Льгота</dt>
                <dd>
                  {{inquiry.privilege.privilegeOrder.name}}<br>
                  <i>{{inquiry.privilege.name}}</i>
                </dd>
                <dt>Документ, подтверждающий льготу</dt>
                <dd>{{getDocumentView(inquiry.privilege.privilegeProofDocument)}}</dd>
              </div>
              <dt>Доп. информация</dt>
              <dd>{{inquiry.addInformation}}</dd>
            </app-inquiry-common-info>
          </div>
        </div>
        <div class="button-row" [formGroup]="statusForm">
          <mat-form-field style="width: 70%">
            <mat-select placeholder="Перевести в статус" formControlName="status" #status>
              <mat-option *ngFor="let status of statuses" [value]="status.id">
                {{status.name}}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <button type="button" class="btn btn-primary" (click)="changeStatus(status.value)">Выполнить</button>
        </div>
      </app-inquiry-info-edit>
    </div>
    <div class="col-md-6" *ngIf="!inquiry.applicant && inquiry.applicantType != applicantTypes.Child">
      <ng-container *ngTemplateOutlet="parentTemplate">
      </ng-container>
    </div>
  </div>
  <div class="row" *ngIf="inquiry.applicant">
    <div class="col-md-6">
      <app-adult-card title="Доверенное лицо законного представителя ребенка" [entity]="inquiry.applicant" [edit]="edit.person">
      </app-adult-card>
    </div>
    <div class="col-md-6" *ngIf="inquiry.applicantType != applicantTypes.Child">
      <ng-container *ngTemplateOutlet="parentTemplate">
      </ng-container>
    </div>
  </div>
  <app-children-card [children]="inquiry.children"></app-children-card>
  <app-preview-school-inquiry-info [schoolInquiryInfo]="inquiry.schoolInquiryInfo" [edit]="edit.schoolInquiryInfo" *ngIf="inquiry.schoolInquiryInfo"></app-preview-school-inquiry-info>
  <app-preschool-preview-inquiry-info [inquiryInfo]="inquiry.inquiryInfo" [edit]="edit.inquiryInfo" *ngIf="inquiry.type == inquiryTypes.preschool"></app-preschool-preview-inquiry-info>
  <div class="row">
    <div class="col-md-4">
      <app-inquiry-info-edit title="Контактная информация" (edit)="edit.contactInfo()">
        <ng-container *ngIf="inquiry.contactInfo.dontNotify">
          <div class="form-group">
            <b>Не оповещать</b>
          </div>
        </ng-container>
        <ng-container *ngIf="!inquiry.contactInfo.dontNotify">
          <dl class="dl-horizontal">
            <dt>Email </dt>
            <dd>{{inquiry.contactInfo.email || "-"}}</dd>
            <dt>Номер для смс </dt>
            <dd>{{inquiry.contactInfo.smsPhone || "-"}}</dd>
            <dt>Телефон(ы) </dt>
            <dd>{{inquiry.contactInfo.phones || "-"}}</dd>
          </dl>
        </ng-container>
      </app-inquiry-info-edit>
    </div>
    <div class="col-md-4">
      <app-inquiry-info-edit title="Предпочитаемые организации" (edit)="edit.institutions()">
        <ng-container *ngIf="inquiry.type == inquiryTypes.preschool">
          <div class="form-group" *ngFor="let institution of inquiry.institutions; let i = index">
            {{i+1}}.{{institution.name}}
          </div>
        </ng-container>
        <ng-container *ngIf="inquiry.type == inquiryTypes.school">
          <div class="form-group">
            <b>Учился в центре образования(ЦО) </b> {{inquiry.IsLearnEducCenter == true ? "Да" : "Нет"}}
          </div>
          <div class="form-group" *ngFor="let schoolClass of inquiry.schoolClasses; let i = index">
            {{i+1}}.{{schoolClass.institution.name}} ({{schoolClass.name}})
          </div>
        </ng-container>
      </app-inquiry-info-edit>
    </div>
    <div class="col-md-4">
      <app-inquiry-info-edit title="Текущее место обучения ребенка" (edit)="edit.currentEducationPlace()">
        <div [ngSwitch]="inquiry.currentEducationPlace.isOther">
          <div *ngSwitchCase="true">
            <div class="form-group">
              <b>Тип </b> Другая
            </div>
            <div class="form-group">
              <b>Образовательная организация </b> {{inquiry.currentEducationPlace.other}}
            </div>
          </div>
          <div *ngSwitchCase="false">
            <dl class="dl-horizontal">
              <dt>Тип </dt>
              <dd>{{($institutionType | async)?.name}}</dd>
              <dt>Образовательная организация </dt>
              <dd>{{inquiry.currentEducationPlace.institution.name}}</dd>
              <dt>Группа/класс </dt>
              <dd>{{inquiry.currentEducationPlace.group?.name || "-" }}</dd>
            </dl>
          </div>
        </div>
      </app-inquiry-info-edit>
    </div>
  </div>
  <div class="row">
    <div class="col-md-4">
      <app-inquiry-info-edit title="Льготная категория" (edit)="edit.privilege()">
        <dl class="dl-horizontal" *ngIf="inquiry.privilege">
          <dt>Приоритет льготной категории </dt>
          <dd>{{inquiry.privilege.privilegeOrder.name}}</dd>
          <dt>Льготная категория </dt>
          <dd>{{inquiry.privilege.name}}</dd>
        </dl>
        <div class="col-md-6" *ngIf="!inquiry.privilege">
          Без льготы
        </div>
        <app-inquiry-info-edit title="Документ, подтверждающий наличие льготной категории" *ngIf="inquiry.privilege?.privilegeProofDocument">
          <dl class="dl-horizontal">
            <dt>Название документа </dt>
            <dd>{{inquiry.privilege.privilegeProofDocument.name}}</dd>
            <dt>Серия документа </dt>
            <dd>{{inquiry.privilege.privilegeProofDocument.series || "-"}}</dd>
            <dt>Номер документа </dt>
            <dd>{{inquiry.privilege.privilegeProofDocument.number}}</dd>
            <dt>Дата выдачи </dt>
            <dd>{{inquiry.privilege.privilegeProofDocument.dateIssue | date: 'dd.MM.yyyy'}}</dd>
            <div class="form-group" *ngIf="inquiry.privilege.privilegeProofDocument.dateExpired">
              <dt>Действительно до </dt>
              <dd>{{inquiry.privilege.privilegeProofDocument.dateExpired | date: 'dd.MM.yyyy'}}</dd>
            </div>
          </dl>
        </app-inquiry-info-edit>
      </app-inquiry-info-edit>
    </div>
    <div class="col-md-4">
      <app-inquiry-info-edit title="Файлы" (edit)="edit.fileAttachments()">
        <div class="form-group" *ngFor="let file of inquiry.filesInfo.files">
          {{file.name}}({{file.description}})
        </div>
        <div class="form-group">
          <b>Документы подписаны электронной подписью</b> {{inquiry.filesInfo.haveDigitalSignature ? "Да" : "Нет"}}
        </div>
      </app-inquiry-info-edit>
    </div>
  </div>

</div>